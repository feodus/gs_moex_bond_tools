# Текущий контекст проекта

## Состояние на 12 декабря 2025 года

Проект MOEX Bond Data for Google Sheets находится в активной разработке. Это библиотека Google Apps Script, которая предоставляет пользовательские функции для получения данных об облигациях с Московской Биржи прямо в Google Таблицах. Проект переименован из rebalance_bonds_11-2025 в gs_moex_bond_tools.

## Текущая функциональность

- Реализованы основные функции для получения данных об облигациях:
  - GET_MOEX_PRICE - текущая цена облигации
  - GET_MOEX_NAME - наименование облигации
- GET_NEXT_COUPON - дата следующего купона
- GET_COUPON_VALUE - размер следующего купона
- GET_MATURITY_DATE - дата погашения
- GET_NEAREST_OPTION_DATE - ближайшая дата опциона или амортизации
- Встроена система кэширования для оптимизации запросов к API
- Добавлена функция массового обновления данных с задержками
- Реализована поддержка флоатеров (облигаций с плавающей ставкой)

## Архитектурные особенности

- Используется Google Apps Script с runtime V8
- Все функции реализованы как Custom Functions для использования в ячейках
- Применяется кэширование с разными интервалами для разных типов данных
- Используются API MOEX для получения данных об облигациях
- Реализована защита от превышения лимитов API

## Текущие задачи

- Поддержка и улучшение стабильности работы с API MOEX
- Расширение покрытия различных типов облигаций
- Оптимизация производительности и улучшение обработки ошибок

## Выявленные проблемы и рекомендации по улучшению

После анализа кода файла script.js были выявлены следующие потенциальные проблемы:

1. Проблема с обработкой кэшированных дат - при десериализации теряется тип Date
2. Непоследовательная обработка пустых тикеров в функции GET_NEAREST_OPTION_DATE
3. Проблема с установкой примечаний в UDF - функция пытается установить примечание, что не работает в контексте пользовательских функций
4. Неоптимальная обработка ошибок - возвращаются общие сообщения без детализации
5. Потенциальное превышение лимитов API при массовом обновлении
6. Недостаточная валидация входных данных
7. Потенциальная проблема с кэшированием при использовании тикеров с пробелами
8. Неэффективное сканирование формул в forceRecalculatePrices
9. Неполная обработка специальных случаев для флоатеров
