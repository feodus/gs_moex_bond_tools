# MOEX_BondData_for_GoogleSheets

Библиотека Google Apps Script для получения данных по облигациям с Московской Биржи (MOEX) в реальном времени прямо в Google Таблицы.

## Возможности

Скрипт предоставляет набор кастомных функций для использования в ячейках таблицы:

### Основные функции

- `=GET_MOEX_PRICE("TICKER")` — Текущая цена облигации (в % от номинала)
- `=GET_MOEX_NAME("TICKER")` — Краткое наименование облигации
- `=GET_NEXT_COUPON("TICKER")` — Дата следующего купона
- `=GET_COUPON_VALUE("TICKER")` — Размер следующего купона (в рублях)
  - _Поддерживает флоатеры_: если купон еще не определен, пытается найти последнее известное значение
- `=GET_MATURITY_DATE("TICKER")` — Дата погашения облигации
- `=GET_NEAREST_OPTION_DATE("TICKER")` — Ближайшая дата опциона (put/call) или амортизации

### Дополнительные возможности

- **Кэширование**: Результаты запросов кэшируются для оптимизации производительности и соблюдения лимитов API MOEX:
  - Цены: 5 минут
  - Дата купона: 6 часов
  - Название и дата погашения: 24 часа
  - Размер купона: 6 часов
- **Массовое обновление**: Меню "MOEX" → "Обновить все данные (с задержкой)" позволяет принудительно пересчитать все формулы с задержкой 400мс между ячейками, чтобы избежать ошибок "Too Many Requests"
- **Поддержка флоатеров**: Для облигаций с плавающей ставкой, если следующий купон еще не объявлен, система автоматически использует последнее известное значение
- **Обработка ошибок**: Комплексная система обработки ошибок и исключений при работе с API

## Установка

1.  Откройте вашу Google Таблицу.
2.  Перейдите в меню **Расширения** > **Apps Script**.
3.  Скопируйте содержимое файла `MOEX_BondData_for_GoogleSheets/script.js` из этого репозитория в редактор кода.
4.  Нажмите **Сохранить** (иконка дискеты).
5.  Вернитесь в таблицу и обновите страницу. Появится меню "MOEX" (может потребоваться несколько секунд).

## Использование

Просто используйте функции как обычные формулы Excel/Google Sheets:

```excel
=GET_MOEX_PRICE("SU26227RMFS7")
=GET_MOEX_NAME("SU26227RMFS7")
=GET_NEXT_COUPON("SU26227RMFS7")
=GET_COUPON_VALUE("SU26227RMFS7")
=GET_MATURITY_DATE("SU26227RMFS7")
=GET_NEAREST_OPTION_DATE("SU26227RMFS7")
```

Где `SU26227RMFS7` — это ISIN код облигации (например, ОФЗ 26227).

## Вклад в проект

Мы приветствуем любой вклад в развитие проекта! Пожалуйста, ознакомьтесь с файлом [CONTRIBUTING.md](CONTRIBUTING.md) для получения информации о том, как начать.

## Кодекс поведения

Участники проекта обязаны соблюдать наш [CODE_OF_CONDUCT.md](CODE_OF_CONDUCT.md).

## Лицензия

Этот проект распространяется под лицензией MIT. Подробности см. в файле [LICENSE](LICENSE).

## История изменений

Последние изменения в проекте можно посмотреть в файле [CHANGELOG.md](CHANGELOG.md).
